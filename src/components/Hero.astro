---
import type { Lang } from "@/i18n";
import { t } from "@/i18n";
import { withLang } from "@/lib/paths";
import { site, phoneHref } from "@/lib/site";
---

<section class="relative overflow-hidden rounded-3xl bg-white shadow-ring">
  <div class="relative h-[72vh] min-h-[560px] w-full">
    <!-- TEK VIDEO: iOS Safari için en sağlam yaklaşım -->
    <video
      id="heroVideo"
      class="absolute inset-0 h-full w-full object-cover object-center"
      src="/videos/hero.mp4"
      autoplay
      muted
      loop
      playsinline
      preload="auto"
      poster="/images/venue-1.jpg"
      aria-hidden="true"
      disablepictureinpicture
      webkit-playsinline
    ></video>

    <!-- Premium overlay: readability + vignette -->
    <div class="absolute inset-0 bg-gradient-to-b from-black/55 via-black/20 to-black/70"></div>
    <div class="absolute inset-0 [box-shadow:inset_0_0_220px_rgba(0,0,0,.55)]"></div>

    <!-- Content -->
    <div class="relative z-10 grid h-full items-end p-6 md:p-10">
      <div
        class="max-w-2xl rounded-3xl bg-white/10 ring-1 ring-white/20
               p-6 md:p-8 backdrop-blur-xl shadow-2xl"
      >
        <div class="pill bg-white/20 text-white ring-1 ring-white/25 backdrop-blur">
          {t(lang, "home.kicker")}
        </div>

        <h1 class="mt-4 font-display text-4xl leading-tight text-white md:text-5xl">
          {t(lang, "home.title")}
        </h1>

        <p class="mt-4 max-w-prose text-white/85">
          {t(lang, "home.subtitle")}
        </p>

        <div class="mt-6 flex flex-wrap gap-3">
          <a class="btn btn-primary" href={site.mapsUrl} target="_blank" rel="noreferrer">
            {t(lang, "cta.route")}
          </a>
          <a
            class="btn btn-ghost ring-1 ring-white/25 bg-white/10 text-white hover:bg-white/20"
            href={phoneHref(site.phoneLocal)}
          >
            {t(lang, "cta.call")}
          </a>
          <a
            class="btn btn-ghost ring-1 ring-white/25 bg-white/10 text-white hover:bg-white/20"
            href={withLang(lang, "/menu")}
          >
            {t(lang, "cta.menu")}
          </a>
        </div>

        <div class="mt-6 text-xs text-white/75">{site.address}</div>
      </div>
    </div>
  </div>

  <!-- iOS/Safari autoplay “garantisi” -->
  <script is:inline>
    (() => {
      const v = document.getElementById("heroVideo");
      if (!v) return;

      const prep = () => {
        try {
          v.muted = true;
          v.defaultMuted = true;
          v.setAttribute("muted", "");
          v.setAttribute("playsinline", "");
          v.setAttribute("webkit-playsinline", "");
          v.playsInline = true;
          v.setAttribute("preload", "auto");
          v.setAttribute("disablepictureinpicture", "");
        } catch {}
      };

      const tryPlay = () => {
        prep();
        const p = v.play?.();
        if (p && typeof p.catch === "function") p.catch(() => {});
      };

      v.addEventListener("canplay", tryPlay, { once: true });
      document.addEventListener("visibilitychange", () => {
        if (!document.hidden) tryPlay();
      });
      window.addEventListener("pageshow", tryPlay);

      // iOS bazen ilk dokunuş ister
      const onFirst = () => {
        tryPlay();
        window.removeEventListener("touchstart", onFirst);
        window.removeEventListener("click", onFirst);
      };
      window.addEventListener("touchstart", onFirst, { passive: true });
      window.addEventListener("click", onFirst);

      tryPlay();
    })();
  </script>
</section>
