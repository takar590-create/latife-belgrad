---
import type { Lang } from "@/i18n";
import { t } from "@/i18n";
import { withLang } from "@/lib/paths";
import { site, phoneHref } from "@/lib/site";
---

<section class="relative overflow-hidden rounded-3xl bg-white shadow-ring">
  <div
    class="relative h-[72vh] min-h-[560px] w-full bg-black"
    style="background-image: url('/images/venue-1.jpg'); background-size: cover; background-position: center;"
  >
    <!-- VIDEO (NO FILTERS for iOS Safari reliability) -->
    <video
      id="heroVideo"
      class="absolute inset-0 h-full w-full object-cover object-center"
      playsinline
      webkit-playsinline
      muted
      autoplay
      loop
      preload="auto"
      poster="/images/venue-1.jpg"
      disablepictureinpicture
    >
      <source src="/videos/hero-ios.mp4" type="video/mp4" />
      <source src="/videos/latife-intro.mp4" type="video/mp4" />
    </video>

    <!-- Premium overlay (filters yerine overlay) -->
    <div class="absolute inset-0 bg-gradient-to-b from-black/55 via-black/18 to-black/70"></div>
    <div class="absolute inset-0 [box-shadow:inset_0_0_220px_rgba(0,0,0,.55)]"></div>

    <!-- Play fallback (autoplay olmazsa görünür) -->
    <button
      id="heroPlayBtn"
      type="button"
      class="absolute left-1/2 top-1/2 z-20 hidden -translate-x-1/2 -translate-y-1/2
             rounded-full bg-white/15 px-6 py-4 text-white ring-1 ring-white/30
             backdrop-blur-xl shadow-2xl active:scale-[0.98]"
      aria-label="Play video"
    >
      <span class="inline-flex items-center gap-3">
        <span class="grid h-10 w-10 place-items-center rounded-full bg-white/20 ring-1 ring-white/25">
          ▶
        </span>
        <span class="text-sm font-medium">Play</span>
      </span>
    </button>

    <!-- Content -->
    <div class="relative z-10 grid h-full items-end p-6 md:p-10">
      <div class="max-w-2xl rounded-3xl bg-white/10 ring-1 ring-white/20 p-6 md:p-8 backdrop-blur-xl shadow-2xl">
        <div class="pill bg-white/20 text-white ring-1 ring-white/25 backdrop-blur">
          {t(lang, "home.kicker")}
        </div>

        <h1 class="mt-4 font-display text-4xl leading-tight text-white md:text-5xl">
          {t(lang, "home.title")}
        </h1>

        <p class="mt-4 max-w-prose text-white/85">
          {t(lang, "home.subtitle")}
        </p>

        <div class="mt-6 flex flex-wrap gap-3">
          <a class="btn btn-primary" href={site.mapsUrl} target="_blank" rel="noreferrer">
            {t(lang, "cta.route")}
          </a>

          <a class="btn btn-ghost ring-1 ring-white/25 bg-white/10 text-white hover:bg-white/20" href={phoneHref(site.phoneLocal)}>
            {t(lang, "cta.call")}
          </a>

          <a class="btn btn-ghost ring-1 ring-white/25 bg-white/10 text-white hover:bg-white/20" href={withLang(lang, "/menu")}>
            {t(lang, "cta.menu")}
          </a>
        </div>

        <div class="mt-6 text-xs text-white/75">{site.address}</div>
      </div>
    </div>
  </div>

  <script is:inline>
    (() => {
      const v = document.getElementById("heroVideo");
      const btn = document.getElementById("heroPlayBtn");
      if (!v || !btn) return;

      const prep = () => {
        v.muted = true;
        v.defaultMuted = true;
        v.playsInline = true;
        v.setAttribute("muted", "");
        v.setAttribute("playsinline", "");
        v.setAttribute("webkit-playsinline", "");
        v.setAttribute("autoplay", "");
      };

      const showBtn = () => btn.classList.remove("hidden");
      const hideBtn = () => btn.classList.add("hidden");

      const tryAutoPlay = () => {
        prep();
        const p = v.play?.();
        if (p && typeof p.catch === "function") {
          p.then(() => hideBtn()).catch(() => showBtn());
        }
      };

      // autoplay dene
      tryAutoPlay();

      // video gerçekten oynarsa butonu gizle
      v.addEventListener("playing", hideBtn);

      // autoplay reddedilirse (iOS policy), kullanıcı dokunuşuyla başlat
      btn.addEventListener("click", () => {
        prep();
        v.play?.().then(() => hideBtn()).catch(() => showBtn());
      });

      // sekme geri gelince tekrar dene
      document.addEventListener("visibilitychange", () => {
        if (!document.hidden) tryAutoPlay();
      });
      window.addEventListener("pageshow", tryAutoPlay);
    })();
  </script>
</section>
